spring.application.name=colombus-auth
server.port=${PORT:8081}

# =========================
# Server / Session / Redis
# =========================
server.forward-headers-strategy=framework
server.reactive.session.cookie.name=AUTHSESSION
server.reactive.session.cookie.http-only=true
server.reactive.session.cookie.secure=false
server.reactive.session.cookie.same-site=Lax

spring.session.store-type=redis
spring.session.redis.repository-type=indexed
server.reactive.session.timeout=30m
spring.session.redis.save-mode=ON_SET_ATTRIBUTE
spring.session.redis.flush-mode=ON_SAVE
spring.session.redis.namespace={authsvc:sess}

spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}

# =========================
# Auth0 OAuth2 (로그인 클라이언트)
# =========================
spring.security.oauth2.client.registration.auth0.client-id=${AUTH0_CLIENT_ID}
spring.security.oauth2.client.registration.auth0.client-secret=${AUTH0_CLIENT_SECRET}
spring.security.oauth2.client.registration.auth0.scope=openid,profile,email,offline_access
spring.security.oauth2.client.registration.auth0.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.auth0.redirect-uri=${GATEWAY_SERVICE_URL}/api/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.auth0.provider=auth0

# 공통 Issuer URI
spring.security.oauth2.client.provider.auth0.issuer-uri=https://${auth0.domain}/
spring.security.oauth2.client.provider.auth0.user-name-attribute=sub

# =========================
# auth.exchange (외부 M2M / 로그인 토큰 검증용)
# =========================
# Auth0가 발급한 access token 검증
auth.exchange.issuers[0].issuer=${spring.security.oauth2.client.provider.auth0.issuer-uri}
auth.exchange.issuers[0].jwkSetUri=${spring.security.oauth2.client.provider.auth0.issuer-uri}.well-known/jwks.json
auth.exchange.issuers[0].audiences[0]=${internal-jwt.issuer}

# 내부 서비스 client_assertion 검증 ... 추가 필요
auth.exchange.issuers[1].issuer=${BFF_SERVICE_URL}
auth.exchange.issuers[1].jwkJson=${BFF_JWK_JSON}
auth.exchange.issuers[1].audiences[0]=${internal-jwt.issuer}
auth.exchange.issuers[2].issuer=${USER_SERVICE_URL}
auth.exchange.issuers[2].jwkJson=${USER_JWK_JSON}
auth.exchange.issuers[2].audiences[0]=${internal-jwt.issuer}

# 허용된 SSO 목록
auth.link.allowed-connections=google-oauth2,windowslive

# =========================
# Custom Auth0 Properties
# =========================
auth0.domain=${AUTH0_DOMAIN_URI}
auth0.client-id=${AUTH0_CLIENT_ID}
auth0.db-connection=${AUTH0_DB_CONNECTION}

# Auth0 Management API
auth0.mgmt.client-id=${AUTH0_MGMT_CLIENT_ID}
auth0.mgmt.client-secret=${AUTH0_MGMT_CLIENT_SECRET}
auth0.mgmt.audience=https://${auth0.domain}/api/v2/

# =========================
# Internal JWT (auth가 발급하는 내부 토큰)
# =========================
internal-jwt.mode=${INTERNAL_JWT_MODE:generate}
internal-jwt.kid=${INTERNAL_JWT_KID:colombus-internal-v1}
internal-jwt.issuer=${INTERNAL_JWT_ISSUER:http://auth-svc.internal}
internal-jwt.audience=default
internal-jwt.ttl-seconds=300

# JWK 모드
internal-jwt.jwk-json:${INTERNAL_JWT_JWK_JSON:}
# PEM 모드
internal-jwt.pem.private-path=${INTERNAL_JWT_PEM_PRIVATE_PATH:}
internal-jwt.pem.public-path=${INTERNAL_JWT_PEM_PUBLIC_PATH:}
# Keystore 모드
internal-jwt.keystore.path=${INTERNAL_JWT_KEYSTORE_PATH:}
internal-jwt.keystore.type=${INTERNAL_JWT_KEYSTORE_TYPE:}
internal-jwt.keystore.password=${INTERNAL_JWT_KEYSTORE_PASSWORD:}
internal-jwt.keystore.alias=${INTERNAL_JWT_KEYSTORE_ALIAS:}
internal-jwt.keystore.key-password=${INTERNAL_JWT_KEYSTORE_KEY_PASSWORD:}

# =========================
# Security Chain
# =========================
security.internal.enabled=false

# =========================
# Frontend URLs
# =========================
app.front.entry-url=${FRONT_ENTRY_URL:http://localhost:5173}
app.logout-return=${app.front.entry-url}

# =========================
# User Service Configuration
# =========================
service.user.base-url=${USER_SERVICE_URL}

# =========================
# Network
# =========================
net.client-ip.trusted-cidrs=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8,::1/128,fc00::/7

spring.config.import=optional:classpath:application-otlp.properties